<div class="inventory-table-container container-fluid">
    <div class="caption-container">
      <div class="caption-title">
        <h5>Inventario Bodega Principal</h5>
      </div>
      <div class="search-bar">
        <input type="text" id="searchInput" class="form-control" placeholder="Buscar..." (input)="onSearch($event)">
      </div>
      <div class="add-button">
        <button class="btn btn-success" data-bs-toggle="modal" data-bs-target="#Modal_add_item">
          <i class="bi bi-plus-square"></i>
        </button>
        <button class="btn btn-success" data-bs-toggle="modal" data-bs-target="#ingresoBodegaModal">
          <i class="bi bi-box-arrow-in-down"></i>
        </button>
        <button class="btn btn-success" id="btnAbrirSalidaBodega" data-bs-toggle="modal" data-bs-target="#salidaBodegaModal">
          <i class="bi bi-box-arrow-up"></i>
        </button>
        <button class="btn btn-success" data-bs-toggle="modal" data-bs-target="#">
          <i class="bi bi-shuffle"></i>
        </button>
        <button class="btn btn-success" id="btnAbrirHistorial" data-bs-toggle="modal" data-bs-target="#detalleHistorialModal">
          <i class="bi bi-clock-history"></i>
        </button>
      </div>
    </div>
    <table id="productTable" class="table table-striped caption-top">
      <thead>
        <tr>
          <th scope="col">CODIGO</th>
          <th scope="col">DESCRIPCIÓN</th>
          <th scope="col">UNIDAD</th>
          <th scope="col">STOCK</th>
          <th scope="col">HERRAMIENTAS</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let product of products; let i = index">
          <td>{{ product.code }}</td>
          <td>{{ product.description }}</td>
          <td>{{ product.unit }}</td>
          <td>{{ product.stock }}</td>
          <td>
            <div class="btn-group" role="group" aria-label="Basic example">
              <button type="button" class="btn btn-success" (click)="onViewProductInfo(i)">
                <i class="bi bi-info-circle"></i>
              </button>
              <button type="button" class="btn btn-warning" (click)="onEditProduct(i)">
                <i class="bi bi-pen"></i>
              </button>
              <button type="button" class="btn btn-danger" (click)="onDeleteProduct(i)">
                <i class="bi bi-trash"></i>
              </button>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

<div class="modal fade" id="Modal_add_item" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="Modal_add_itemLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h1 class="modal-title fs-5" id="Modal_add_itemLabel">Creación de Producto</h1>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form (ngSubmit)="onAddProduct()" #productForm="ngForm" class="row g-3 needs-validation" novalidate>
                    <div class="col-md-4">
                        <label for="productCode" class="form-label">Codigo Producto</label>
                        <input type="text" class="form-control" id="productCode" required [(ngModel)]="newProduct.code" name="code">
                        <div *ngIf="productForm.submitted && !productForm.controls['code']?.valid" class="invalid-feedback">
                            Por favor ingrese el código del producto.
                        </div>
                    </div>
                    <div class="col-md-4">
                        <label for="productName" class="form-label">Nombre Producto</label>
                        <input type="text" class="form-control" id="productName" required [(ngModel)]="newProduct.name" name="name">
                        <div *ngIf="productForm.submitted && !productForm.controls['name']?.valid" class="invalid-feedback">
                            Por favor ingrese el nombre del producto.
                        </div>
                    </div>
                    <div class="col-md-4">
                        <label for="productDescription" class="form-label">Descripción</label>
                        <input type="text" class="form-control" id="productDescription" required [(ngModel)]="newProduct.description" name="description">
                        <div *ngIf="productForm.submitted && !productForm.controls['description']?.valid" class="invalid-feedback">
                            Por favor ingrese la descripción del producto.
                        </div>
                    </div>
                    <div class="col-md-4">
                        <label for="productModel" class="form-label">Modelo</label>
                        <input type="text" class="form-control" id="productModel" required [(ngModel)]="newProduct.model" name="model">
                        <div *ngIf="productForm.submitted && !productForm.controls['model']?.valid" class="invalid-feedback">
                            Por favor ingrese el modelo del producto.
                        </div>
                    </div>
                    <div class="col-md-4">
                        <label for="productBrand" class="form-label">Marca</label>
                        <input type="text" class="form-control" id="productBrand" required [(ngModel)]="newProduct.brand" name="brand">
                        <div *ngIf="productForm.submitted && !productForm.controls['brand']?.valid" class="invalid-feedback">
                            Por favor ingrese la marca del producto.
                        </div>
                    </div>
                    <div class="col-md-4">
                        <label for="productMaterial" class="form-label">Material</label>
                        <input type="text" class="form-control" id="productMaterial" [(ngModel)]="newProduct.material" name="material">
                    </div>
                    <div class="col-md-4">
                        <label for="productColor" class="form-label">Color</label>
                        <input type="text" class="form-control" id="productColor" [(ngModel)]="newProduct.color" name="color">
                    </div>
                    <div class="col-md-4">
                        <label for="productFamily" class="form-label">Familia</label>
                        <input type="text" class="form-control" id="productFamily" required [(ngModel)]="newProduct.family" name="family">
                        <div *ngIf="productForm.submitted && !productForm.controls['family']?.valid" class="invalid-feedback">
                            Por favor seleccione una familia.
                        </div>
                    </div>
                    <div class="col-md-4">
                        <label for="productValue" class="form-label">Valor Neto</label>
                        <input type="number" class="form-control" id="productValue" required [(ngModel)]="newProduct.value" name="value">
                        <div *ngIf="productForm.submitted && !productForm.controls['value']?.valid" class="invalid-feedback">
                            Por favor ingrese el valor neto del producto.
                        </div>
                    </div>
                    <div class="col-md-4">
                        <label for="productCurrency" class="form-label">Tipo de Moneda</label>
                        <select class="form-select" id="productCurrency" required [(ngModel)]="newProduct.currency" name="currency">
                            <option selected disabled value="">Elegir...</option>
                            <option>CLP</option>
                            <option>USD</option>
                            <option>EUR</option>
                        </select>
                        <div *ngIf="productForm.submitted && !productForm.controls['currency']?.valid" class="invalid-feedback">
                            Por favor seleccione un tipo de moneda.
                        </div>
                    </div>
                    <div class="col-md-4">
                        <label for="productUnit" class="form-label">Unidad</label>
                        <input type="text" class="form-control" id="productUnit" required [(ngModel)]="newProduct.unit" name="unit">
                        <div *ngIf="productForm.submitted && !productForm.controls['unit']?.valid" class="invalid-feedback">
                            Por favor ingrese la unidad del producto.
                        </div>
                    </div>
                    <div class="col-md-4">
                        <label for="productLocation" class="form-label">Ubicación</label>
                        <input type="text" class="form-control" id="productLocation" required [(ngModel)]="newProduct.location" name="location">
                        <div *ngIf="productForm.submitted && !productForm.controls['location']?.valid" class="invalid-feedback">
                            Por favor ingrese la ubicación del producto.
                        </div>
                    </div>
                    <div class="col-12">
                        <button class="btn btn-primary" type="submit">Crear Producto</button>
                    </div>
                </form>                      
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
            </div>
        </div>
    </div>
</div>


<div class="modal fade" id="productInfoModal" tabindex="-1" aria-labelledby="productInfoModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="productInfoModalLabel">Información del Producto</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <ul class="list-group">
                    <li class="list-group-item"><strong>Código:</strong> <span id="productInfoCode"></span></li>
                    <li class="list-group-item"><strong>Nombre:</strong> <span id="productInfoName"></span></li>
                    <li class="list-group-item"><strong>Descripción:</strong> <span id="productInfoDescription"></span></li>
                    <li class="list-group-item"><strong>Modelo:</strong> <span id="productInfoModel"></span></li>
                    <li class="list-group-item"><strong>Marca:</strong> <span id="productInfoBrand"></span></li>
                    <li class="list-group-item"><strong>Material:</strong> <span id="productInfoMaterial"></span></li>
                    <li class="list-group-item"><strong>Color:</strong> <span id="productInfoColor"></span></li>
                    <li class="list-group-item"><strong>Familia:</strong> <span id="productInfoFamily"></span></li>
                    <li class="list-group-item"><strong>Valor:</strong> <span id="productInfoValue"></span></li>
                    <li class="list-group-item"><strong>Moneda:</strong> <span id="productInfoCurrency"></span></li>
                    <li class="list-group-item"><strong>Unidad:</strong> <span id="productInfoUnit"></span></li>
                    <li class="list-group-item"><strong>Ubicación:</strong> <span id="productInfoLocation"></span></li>
                    <li class="list-group-item"><strong>Stock:</strong> <span id="productInfoStock"></span></li>
                </ul>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="ingresoBodegaModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Ingreso a Bodega</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="ingresoBodegaForm">
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="registroNumero" class="form-label">Ingreso n°:</label>
                            <input type="text" class="form-control" id="registroNumero" readonly>
                        </div>
                        <div class="col-md-6">
                            <label for="fechaHora" class="form-label">Fecha:</label>
                            <input type="text" class="form-control" id="fechaHora" readonly>
                        </div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="selectProducto" class="form-label">Producto:</label>
                            <select class="form-select" id="selectProducto"></select>
                        </div>
                        <div class="col-md-6">
                            <label for="cantidadIngreso" class="form-label">Cantidad a Ingresar:</label>
                            <input type="number" class="form-control" id="cantidadIngreso" min="1">
                        </div>
                    </div>
                    <button type="button" class="btn btn-primary mb-3" id="btnIngresarProducto">Ingresar Producto</button>
                    <div style="max-height: 300px; overflow-y: auto;">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th scope="col">Producto</th>
                                    <th scope="col">Nombre</th>
                                    <th scope="col">Descripción</th>
                                    <th scope="col">Stock Actual</th>
                                    <th scope="col">Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="tablaIngreso"></tbody>
                        </table>
                    </div>
                    <div class="mb-3">
                        <button type="button" class="btn btn-success" id="btnConfirmarIngreso">Confirmar Ingreso</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="editProductModal" tabindex="-1" aria-labelledby="editProductModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editProductModalLabel">Editar Producto</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="editProductForm">
                    <div class="mb-3">
                        <label for="editProductCode" class="form-label">Código</label>
                        <input type="text" class="form-control" id="editProductCode" readonly>
                    </div>
                    <div class="mb-3">
                        <label for="editProductName" class="form-label">Nombre</label>
                        <input type="text" class="form-control" id="editProductName" required>
                    </div>
                    <div class="mb-3">
                        <label for="editProductDescription" class="form-label">Descripción</label>
                        <input type="text" class="form-control" id="editProductDescription" required>
                    </div>
                    <div class="mb-3">
                        <label for="editProductModel" class="form-label">Modelo</label>
                        <input type="text" class="form-control" id="editProductModel">
                    </div>
                    <div class="mb-3">
                        <label for="editProductBrand" class="form-label">Marca</label>
                        <input type="text" class="form-control" id="editProductBrand">
                    </div>
                    <div class="mb-3">
                        <label for="editProductMaterial" class="form-label">Material</label>
                        <input type="text" class="form-control" id="editProductMaterial">
                    </div>
                    <div class="mb-3">
                        <label for="editProductColor" class="form-label">Color</label>
                        <input type="text" class="form-control" id="editProductColor">
                    </div>
                    <div class="mb-3">
                        <label for="editProductFamily" class="form-label">Familia</label>
                        <input type="text" class="form-control" id="editProductFamily">
                    </div>
                    <div class="mb-3">
                        <label for="editProductValue" class="form-label">Valor</label>
                        <input type="number" class="form-control" id="editProductValue">
                    </div>
                    <div class="mb-3">
                        <label for="editProductCurrency" class="form-label">Moneda</label>
                        <input type="text" class="form-control" id="editProductCurrency">
                    </div>
                    <div class="mb-3">
                        <label for="editProductUnit" class="form-label">Unidad</label>
                        <input type="text" class="form-control" id="editProductUnit" required>
                    </div>
                    <div class="mb-3">
                        <label for="editProductLocation" class="form-label">Ubicación</label>
                        <input type="text" class="form-control" id="editProductLocation">
                    </div>
                    <div class="mb-3">
                        <label for="editProductStock" class="form-label">Stock</label>
                        <input type="number" class="form-control" id="editProductStock" readonly>
                    </div>
                    <button type="submit" class="btn btn-primary">Guardar Cambios</button>
                </form>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="salidaBodegaModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Salida de Bodega</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="salidaBodegaForm">
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="registroNumeroSalida" class="form-label">Salida n°:</label>
                            <input type="text" class="form-control" id="registroNumeroSalida" readonly>
                        </div>
                        <div class="col-md-6">
                            <label for="fechaHoraSalida" class="form-label">Fecha:</label>
                            <input type="text" class="form-control" id="fechaHoraSalida" readonly>
                        </div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="selectProductoSalida" class="form-label">Producto:</label>
                            <select class="form-select" id="selectProductoSalida"></select>
                        </div>
                        <div class="col-md-6">
                            <label for="cantidadSalida" class="form-label">Cantidad a Sacar:</label>
                            <input type="number" class="form-control" id="cantidadSalida" min="1">
                        </div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="tipoDocumento" class="form-label">Tipo de Documento:</label>
                            <select class="form-select" id="tipoDocumento" required>
                                <option selected disabled value="">Elegir...</option>
                                <option value="VD">VD</option>
                                <option value="OE">OE</option>
                            </select>
                            <div class="invalid-feedback">
                                Por favor seleccione un tipo de documento.
                            </div>
                        </div>
                        <div class="col-md-6">
                            <label for="numeroDocumento" class="form-label">Número de Documento:</label>
                            <input type="text" class="form-control" id="numeroDocumento" required>
                            <div class="invalid-feedback">
                                Por favor ingrese el número del documento.
                            </div>
                        </div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-md-12">
                            <label for="motivoSalida" class="form-label">Motivo de la Salida:</label>
                            <textarea class="form-control" id="motivoSalida" rows="3"></textarea>
                        </div>
                    </div>
                    <button type="button" class="btn btn-primary mb-3" id="btnAgregarSalida">Agregar Salida</button>
                    <div style="max-height: 300px; overflow-y: auto;">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th scope="col">Producto</th>
                                    <th scope="col">Nombre</th>
                                    <th scope="col">Descripción</th>
                                    <th scope="col">Stock Actual</th>
                                    <th scope="col">Cantidad</th>
                                </tr>
                            </thead>
                            <tbody id="tablaSalida"></tbody>
                        </table>
                    </div>
                    <div class="mb-3">
                        <button type="button" class="btn btn-success" id="btnConfirmarSalida" disabled>Confirmar Salida</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Modal de Confirmación de Eliminación -->
<div class="modal fade" id="confirmDeleteModal" tabindex="-1" aria-labelledby="confirmDeleteModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="confirmDeleteModalLabel">Confirmar Eliminación</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>¿Seguro que deseas eliminar el producto <span id="deleteProductCode"></span>?</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">No</button>
                <button type="button" class="btn btn-danger" id="confirmDeleteButton">Sí, eliminar</button>
            </div>
        </div>
    </div>
</div>

<div class="toast-container position-fixed bottom-0 end-0 p-3">
    <div id="ingresoExitosoToast" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
        <div class="toast-header">
            <img src="../img/logos/favicon.png" width="20px" height="20px" class="rounded me-2" alt="Logo">
            <strong class="me-auto">Notificación</strong>
            <small class="text-muted">Ahora</small>
            <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
        </div>
        <div class="toast-body">
            Ingreso exitoso: Ingreso n° <span id="ingresoNumeroToast"></span> realizado con éxito.
        </div>
    </div>

    <div id="salidaExitosaToast" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
        <div class="toast-header">
            <img src="../img/logos/favicon.png" width="20px" height="20px" class="rounded me-2" alt="Logo">
            <strong class="me-auto">Notificación</strong>
            <small class="text-muted">Ahora</small>
            <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
        </div>
        <div class="toast-body">
            Salida exitosa: Salida n° <span id="salidaNumeroToast"></span> realizada con éxito.
        </div>
    </div>
</div>

<!-- Modal de Historial -->
<div class="modal fade" id="detalleHistorialModal" tabindex="-1" aria-labelledby="detalleHistorialModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="detalleHistorialModalLabel">Historial de Movimientos</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <table class="table">
                    <thead>
                        <tr>
                            <th scope="col">Tipo</th>
                            <th scope="col">Número</th>
                            <th scope="col">Fecha</th>
                            <th scope="col">Detalles</th>
                        </tr>
                    </thead>
                    <tbody id="tablaHistorial"></tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<!-- Modal Detalles de Movimiento -->
<div class="modal fade" id="detalleMovimientoModal" tabindex="-1" aria-labelledby="detalleMovimientoModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="detalleMovimientoModalLabel">Detalle del Movimiento</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body" id="detalleMovimientoContent">
                <!-- Detalles del movimiento go here -->
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" id="btnVolverHistorial">Volver al Historial</button>
            </div>
        </div>
    </div>
</div>